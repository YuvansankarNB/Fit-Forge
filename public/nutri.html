<!DOCTYPE html>
<html lang="en" ng-app="fitForgeApp">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitForge - Nutrition</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:Arial, sans-serif; background:#f5f5f5; color:#333; line-height:1.6; }
    .header { background:#2c3e50; color:white; padding:1rem 0; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .nav-container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:0 20px; }
    .logo { font-size:1.8rem; font-weight:bold; color:#e74c3c; }
    .nav-menu { display:flex; list-style:none; gap:2rem; }
    .nav-menu a { color:white; text-decoration:none; padding:0.5rem 1rem; border-radius:5px; transition:0.3s; }
    .nav-menu a:hover, .nav-menu a.active { background:#e74c3c; }
    .container { max-width:1200px; margin:2rem auto; padding:0 20px; }
    .page-title { font-size:2rem; margin-bottom:2rem; color:#2c3e50; text-align:center; }
    .nutrition-summary { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-bottom:2rem; }
    .nutrition-item { background:white; padding:1.5rem; border-radius:10px; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .nutrition-value { font-size:2.5rem; font-weight:bold; color:#e74c3c; margin-bottom:0.5rem; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:2rem; margin-bottom:2rem; }
    .card { background:white; border-radius:10px; padding:2rem; box-shadow:0 2px 10px rgba(0,0,0,0.1); border-left:4px solid #e74c3c; }
    .form-group { margin:1rem 0; }
    .form-group label { display:block; margin-bottom:0.5rem; font-weight:bold; }
    .form-group input, .form-group select { width:100%; padding:10px; border:2px solid #ddd; border-radius:5px; }
    .btn { background:#e74c3c; color:white; border:none; padding:12px 24px; border-radius:5px; cursor:pointer; font-size:1rem; width:100%; transition:0.3s; }
    .btn:hover { background:#c0392b; }
    .meal-item { background:#f8f9fa; padding:1rem; border-radius:5px; margin:0.5rem 0; border-left:3px solid #e74c3c; }
    .water-glass { width:30px; height:40px; border:2px solid #3498db; border-radius:0 0 15px 15px; cursor:pointer; }
    .water-glass.filled { background:#3498db; }
    @media(max-width:768px){.nav-menu{flex-direction:column; gap:0.5rem;} .card-grid{grid-template-columns:1fr;} }
  </style>
</head>
<body ng-controller="NutritionCtrl">
<header class="header">
  <div class="nav-container">
    <div class="logo">FitForge</div>
    <nav>
      <ul class="nav-menu">
        <li><a href="home.html">Dashboard</a></li>
        <li><a href="work.html">Workouts</a></li>
        <li><a href="pro.html">Progress</a></li>
        <li><a href="nutri.html" class="active">Nutrition</a></li>
        <li><a href="cls.html">Classes</a></li>
        <li><a href="money.html">Membership</a></li>
        <li><a href="prof.html">Profile</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <h1 class="page-title">Nutrition Tracker</h1>

  <!-- Meals -->
  <div class="card-grid">
    <div class="card">
      <h3>Add Food</h3>
      <div class="form-group"><label>Food Name</label><input type="text" ng-model="food.name"></div>
      <div class="form-group"><label>Calories per 100g</label><input type="number" ng-model="food.calories"></div>
      <div class="form-group"><label>Amount (g)</label><input type="number" ng-model="food.amount"></div>
      <div class="form-group"><label>Meal Type</label>
        <select ng-model="food.mealType">
          <option value="breakfast">Breakfast</option><option value="lunch">Lunch</option>
          <option value="dinner">Dinner</option><option value="snack">Snack</option>
        </select>
      </div>
      <button class="btn" ng-click="addFood()">Add Food</button>
    </div>

    <div class="card">
      <h3>Today's Meals</h3>
      <div class="meal-item" ng-repeat="m in meals">{{m.mealType | uppercase}} - {{m.name}} ({{m.calories}} cal)</div>
    </div>

    <div class="card">
      <h3>Water Intake</h3>
      <div>
        <div class="water-glass" ng-repeat="n in [].constructor(8) track by $index" ng-class="{filled: $index < waterCount}" ng-click="setWater($index+1)"></div>
      </div>
      <p>{{waterCount}} / 8 glasses</p>
      <button class="btn" ng-click="saveWater()">Save Water</button>
    </div>
  </div>
</main>

<script>
var app = angular.module("fitForgeApp", []);
app.controller("NutritionCtrl", function($scope) {
  const userId = localStorage.getItem("userId");
  $scope.food = {};
  $scope.meals = [];
  $scope.waterCount = 0;

  // load meals
  fetch("/api/meals/" + userId).then(r=>r.json()).then(d=>$scope.$apply(()=>{$scope.meals=d;}));
  // load water
  fetch("/api/water/" + userId).then(r=>r.json()).then(d=>$scope.$apply(()=>{$scope.waterCount=d.count||0;}));

  $scope.addFood = function(){
    fetch("/api/meals", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({userId, ...$scope.food})
    }).then(r=>r.json()).then(m=>{
      $scope.$apply(()=>{$scope.meals.push(m); $scope.food={};});
    });
  };
  $scope.setWater = function(n){ $scope.waterCount=n; };
  $scope.saveWater = function(){
    fetch("/api/water", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({userId, count:$scope.waterCount})
    }).then(()=>alert("Water saved!"));
  };
});
</script>
</body>
</html>
